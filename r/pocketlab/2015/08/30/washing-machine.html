<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Washing apparatus ready detection (WARD) | Martin’s blog</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Washing apparatus ready detection (WARD)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Using a PocketLab put on the top of a washing machine, we measure the magnetic field generated by the motor. The magnitude of this vector is used to detect if the motor is on, and when the motor has been off for some time, we say that the cycle is finished." />
<meta property="og:description" content="Using a PocketLab put on the top of a washing machine, we measure the magnetic field generated by the motor. The magnitude of this vector is used to detect if the motor is on, and when the motor has been off for some time, we say that the cycle is finished." />
<link rel="canonical" href="http://blog.martisak.se/r/pocketlab/2015/08/30/washing-machine.html" />
<meta property="og:url" content="http://blog.martisak.se/r/pocketlab/2015/08/30/washing-machine.html" />
<meta property="og:site_name" content="Martin’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-08-30T23:53:48+02:00" />
<script type="application/ld+json">
{"url":"http://blog.martisak.se/r/pocketlab/2015/08/30/washing-machine.html","headline":"Washing apparatus ready detection (WARD)","dateModified":"2015-08-30T23:53:48+02:00","datePublished":"2015-08-30T23:53:48+02:00","description":"Using a PocketLab put on the top of a washing machine, we measure the magnetic field generated by the motor. The magnitude of this vector is used to detect if the motor is on, and when the motor has been off for some time, we say that the cycle is finished.","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.martisak.se/r/pocketlab/2015/08/30/washing-machine.html"},"@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://blog.martisak.se/feed.xml" title="Martin's blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Martin&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/">Home</a><a class="page-link" href="/publications.html">Publications</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Washing apparatus ready detection (WARD)</h1>
    <p class="post-meta">
      <i class="fas fa-calendar"></i>&nbsp;<time class="dt-published" datetime="2015-08-30T23:53:48+02:00" itemprop="datePublished">Aug 30, 2015
      </time><span class="reading-time"><i class="fas fa-stopwatch"></i>&nbsp;3 min read.</span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Using a <a href="http://thepocketlab.com/">PocketLab</a> put on the top of a washing machine, we measure the magnetic field generated by the motor. The magnitude of this vector is used to detect if the motor is on, and when the motor has been off for some time, we say that the cycle is finished.</p>

<!--more-->

<h2 id="checkpoint">Checkpoint</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#library(checkpoint)</span><span class="w">
</span><span class="c1">#checkpoint("2015-08-26")</span><span class="w">
</span></code></pre></div></div>

<h2 id="libraries">Libraries</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">TTR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">printr</span><span class="p">)</span><span class="w">

</span><span class="c1">#library(mime)</span><span class="w">
</span></code></pre></div></div>

<h2 id="read-data">Read data</h2>

<p>Read data from PocketLab CSV and calculate magnitude from <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">y</code> and <code class="highlighter-rouge">z</code> components. Then use an Exponential Moving Average filter to remove the trend (seems like the sensor does not return to zero when the washing machine motor turns off).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wash</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/Magnetic field368141090.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="s2">"z"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">mutate</span><span class="p">(</span><span class="w">
		</span><span class="n">magnitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="o">^</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="c1"># Calculate magnitude</span><span class="w">
		</span><span class="n">magnitude_ema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EMA</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="w"> </span><span class="c1"># Exponential Moving Average</span><span class="w">
		</span><span class="n">magnitude_adj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magnitude</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">magnitude_ema</span><span class="p">,</span><span class="w"> </span><span class="c1"># Remove trend</span><span class="w">
		</span><span class="n">magnitude_abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magnitude_adj</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">abs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">EMA</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">),</span><span class="w">
		</span><span class="n">magnitude_abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">magnitude_abs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">as.vector</span><span class="p">,</span><span class="w"> </span><span class="c1"># Absolute value and more EMA</span><span class="w">
		</span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">magnitude_abs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
	</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1190</span><span class="p">)</span><span class="w">

</span><span class="n">wash</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: right">time</th>
      <th style="text-align: right">x</th>
      <th style="text-align: right">y</th>
      <th style="text-align: right">z</th>
      <th style="text-align: right">magnitude</th>
      <th style="text-align: right">magnitude_ema</th>
      <th style="text-align: right">magnitude_adj</th>
      <th style="text-align: right">magnitude_abs</th>
      <th style="text-align: right">threshold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0.00</td>
      <td style="text-align: right">0.0610352</td>
      <td style="text-align: right">0.0610352</td>
      <td style="text-align: right">-0.3051758</td>
      <td style="text-align: right">0.3171480</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
    </tr>
    <tr>
      <td style="text-align: right">0.02</td>
      <td style="text-align: right">0.0610352</td>
      <td style="text-align: right">-0.0305176</td>
      <td style="text-align: right">-0.1220703</td>
      <td style="text-align: right">0.1398491</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
    </tr>
    <tr>
      <td style="text-align: right">0.08</td>
      <td style="text-align: right">0.1525879</td>
      <td style="text-align: right">0.0915527</td>
      <td style="text-align: right">-0.3356934</td>
      <td style="text-align: right">0.3799408</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
    </tr>
    <tr>
      <td style="text-align: right">0.16</td>
      <td style="text-align: right">0.0305176</td>
      <td style="text-align: right">0.1220703</td>
      <td style="text-align: right">0.0610352</td>
      <td style="text-align: right">0.1398491</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
    </tr>
    <tr>
      <td style="text-align: right">0.26</td>
      <td style="text-align: right">0.0000000</td>
      <td style="text-align: right">0.0305176</td>
      <td style="text-align: right">-0.0305176</td>
      <td style="text-align: right">0.0431584</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
    </tr>
    <tr>
      <td style="text-align: right">0.36</td>
      <td style="text-align: right">0.0000000</td>
      <td style="text-align: right">0.0000000</td>
      <td style="text-align: right">-0.3967285</td>
      <td style="text-align: right">0.3967285</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
    </tr>
  </tbody>
</table>

<p>Rearrange and plot <code class="highlighter-rouge">x</code>,<code class="highlighter-rouge">y</code> and <code class="highlighter-rouge">z</code> components.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wash2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">wash</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">matches</span><span class="p">(</span><span class="s2">"magnitude"</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="s2">"axis"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">,</span><span class="o">-</span><span class="n">time</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">wash2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">facet_grid</span><span class="p">(</span><span class="n">axis</span><span class="o">~</span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">scale_colour_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figure/mag_axis-1.png" alt="plot of chunk mag_axis" /></p>

<p>Plot the magnitude</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">wash</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">magnitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figure/mag1-1.png" alt="plot of chunk mag1" /></p>

<p>Plot the magnitude trend</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">wash</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">magnitude_ema</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning: Removed 19 rows containing missing values (geom_path).
</code></pre></div></div>

<p><img src="/figure/mag2-1.png" alt="plot of chunk mag2" /></p>

<p>Plot the adjusted magnitude (removed magnitude trend).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">wash</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">magnitude_adj</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning: Removed 19 rows containing missing values (geom_path).
</code></pre></div></div>

<p><img src="/figure/mag3-1.png" alt="plot of chunk mag3" /></p>

<p>Plot the normalized absolute magnitude.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">wash</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">magnitude_abs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning: Removed 68 rows containing missing values (geom_path).
</code></pre></div></div>

<p><img src="/figure/mag4-1.png" alt="plot of chunk mag4" /></p>

<p>Using zero as a threshold, plot on or off status.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">wash</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">threshold</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="w"> </span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning: Removed 68 rows containing missing values (geom_path).
</code></pre></div></div>

<p><img src="/figure/mag5-1.png" alt="plot of chunk mag5" /></p>



    <h2 id="references">References</h2>
    <ol class="bibliography"></ol>

  </div><a class="u-url" href="/r/pocketlab/2015/08/30/washing-machine.html" hidden></a>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Martin&#39;s blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Martin&#39;s blog</li><li><a class="u-email" href="mailto:martin@martisak.se">martin@martisak.se</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/martisak"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">martisak</span></a></li><li><a href="https://www.linkedin.com/in/martisak"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">martisak</span></a></li><li><a href="https://www.twitter.com/martin_isaksson"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">martin_isaksson</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Researcher, PhD candidate, engineer</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
